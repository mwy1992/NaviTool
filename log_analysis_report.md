# 📄 日志分析报告：吉利地图导致 HUD 消失问题

**分析对象**: `navitool.logcat.2026-01-21(2).txt`  
**问题描述**: 打开吉利地图后，HUD 画面消失。

## 🔎 核心发现

经过对日志的详细时间轴分析，发现**HUD 消失的根本原因并非简单的“隐藏”指令，而是整个应用程序进程（NaviTool）崩溃或被系统清理了。**

### ⚠️ 关键时间轴

1. **HUD 正常启动** (22:38:50)
    * `22:38:50.295`: HUD 管理器初始化 (`ClusterHudManagerApi30 Initialized`)
    * `22:38:50.383`: HUD 成功显示 (`HUD Presentation Created & Shown on Display 1`)

2. **吉利地图启动** (22:46:51)
    * `22:46:51.269`: 检测到吉利地图进入全屏前台 (`Pkg=com.geely.map ... FullScreen=true`)
    * **在此之后，日志出现约 16 秒的空白或中断。**

3. **进程重启** (22:47:07)
    * `22:47:07.748`: 应用程序重新开始初始化 (`AmapMonitorManager: Broadcast processing thread initialized`)
    * `22:47:07.786`: HUD 管理器再次进行自我初始化 (`ClusterHudManager: Self-Init`)
    * `22:47:07.953`: API30 管理器重新加载 (`ClusterHudManagerApi30 Initialized`)

### 💀 故障诊断：进程终止 (Process Termination)

在 `22:46:51`（吉利地图打开）到 `22:47:07`（应用重启）之间，NaviTool 的进程被终止了。随后，由于无障碍服务 (AccessibilityService) 具有自动重启机制，系统又尝试重新拉起了应用。

**HUD 消失** 实际上是 **HUD 崩溃** 的副作用。

## 🧐 可能原因分析

由于日志中没有捕获到 Java 层的崩溃堆栈（Stack Trace），表明这可能是一次 **系统级强杀** 或 **Native 层崩溃**。

1. **OOM 系统杀后台 (最可能)**
    * 吉利地图等导航软件是内存消耗大户。
    * 在车机内存紧张的情况下，Android 系统会优先保证前台导航流畅，可能会杀掉后台服务或辅助服务来释放内存。
    * 尽管无障碍服务优先级较高，但在极端内存压力下仍可能被回收。

2. **配置变更导致的 Native 崩溃**
    * 日志显示吉利地图启动时触发了窗口变化。
    * 导航软件可能会更改屏幕分辨率或密度 (Density)，这会触发 `ACTION_CONFIGURATION_CHANGED`。
    * 虽然我们在 Java 层处理了该事件，但如果底层 AdaptAPI（车机接口）在处理配置变更时不稳，可能会导致 Native Crash，这种崩溃不会留下 Java 日志，直接带走整个进程。

3. **资源冲突**
    * 如果吉利地图尝试独占某些硬件资源（如音频通道、显示层），可能会导致与之竞争的 NaviTool 异常退出。

## 🛠️ 建议解决方案

针对进程被杀的问题，建议尝试以下优化：

1. **内存优化**: 检查是否加载了过大的图片（如未压缩的音乐封面）。
2. **降低优先级**: 这是一个反直觉的尝试。如果系统判定辅助服务消耗过高，尝试禁用一些非核心功能（如某些高频传感器轮询）。
3. **保护机制 (已部分实施)**:
    * 我们已经有的 `KeepAliveAccessibilityService` 是目前能做的最好的保活手段。
    * 可以尝试在开发者选项中查看是否有“后台进程限制”被设置。
4. **抓取崩溃日志**:
    * 如果可能，请尝试抓取包含 `*:E` (错误级别) 的更完整日志，特别是系统层面的日志 (`ActivityManager` 或 `lowmemorykiller`)，这能确认是否是 OOM 杀进程。

**结论**: HUD 代码逻辑本身没有发出“隐藏”指令。问题在于应用为了给吉利地图让路，被系统“杀”死了。
